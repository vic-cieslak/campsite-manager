{% extends "base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<style>
    #floatingContainer {
      position: fixed;
      bottom: 20px;
      right: 20px;
      display: flex;
      align-items: center;
      gap: 10px; /* Space between the button and the price */
      z-index: 1000;
    }
  
    .floating-box {
      background-color: #1e40af; /* Tailwind's blue-600 */
      color: white;
      padding: 16px;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      font-size: 18px;
      font-weight: 600;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      width: 200px; /* Set equal width */
      height: 60px; /* Set equal height */
    }
  
    #reservationButton {
      background-color: #38af1e; /* Tailwind's blue-600 */
      color: white;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
      transition: background-color 0.3s ease;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      text-align: center;
      width: 200px; /* Set equal width */
      height: 60px; /* Set equal height */
      display: flex;
      justify-content: center;
      align-items: center;
    }
  
    #reservationButton:hover {
      background-color: #1d4ed8; /* Hover color */
    }
  </style>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <div class="container mx-auto mt-4 mb-32 px-4 md:px-0">
        <h1 class="text-2xl font-semibold mb-4 text-center">Zarezerwuj miejsce na kempingu</h1>
        <form method="post" class="needs-validation" novalidate id="reservationForm">
            {% csrf_token %}
            
            <!-- User Info -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 max-w-sm mx-auto">
                <div>
                    {{ form.full_name|as_crispy_field }}
                </div>
                <div>
                    {{ form.email|as_crispy_field }}
                </div>
                <div>
                    {{ form.phone_number|as_crispy_field }}
                </div>
            </div>

            <!-- Dates -->
            <hr class="my-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 max-w-sm mx-auto">
                <div>
                    {{ form.start_date|as_crispy_field }}
                </div>
                <div>
                    {{ form.end_date|as_crispy_field }}
                </div>
            </div>

            <!-- Number of People -->
            <hr class="my-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 max-w-sm mx-auto">
                <div>
                    {{ form.num_adults|as_crispy_field }} 
                    <input type="hidden" id="price_per_adult" value="50">
                </div>
                <div>
                    {{ form.num_children_0_3|as_crispy_field }}
                    <input type="hidden" id="price_per_child_0_3" value="0">
                </div>
                <div>
                    {{ form.num_children_4_13|as_crispy_field }}
                    <input type="hidden" id="price_per_child_4_13" value="30">
                </div>
            </div>

            <!-- Camping Details -->
            <hr class="my-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 max-w-sm mx-auto">
                <div>
                    {{ form.tent_type|as_crispy_field }}
                </div>
                <div>
                    {{ form.caravan_required|as_crispy_field }}
                    <input type="hidden" id="price_for_caravan" value="100">
                </div>
            </div>

            <!-- Electricity and Extras -->
            <hr class="my-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6 max-w-sm mx-auto">
                <div>
                    {{ form.electricity_for_tent|as_crispy_field }}
                    <input type="hidden" id="price_for_electricity_tent" value="20">
                </div>
                <div>
                    {{ form.electricity_for_caravan|as_crispy_field }}
                    <input type="hidden" id="price_for_electricity_caravan" value="30">
                </div>
                <div>
                    {{ form.extra_person_count|as_crispy_field }}
                    <input type="hidden" id="price_per_extra_person" value="40">
                </div>
            </div>

            <!-- Additional Services -->
            <hr class="my-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 max-w-sm mx-auto">
                <div>
                    {{ form.waste_disposal|as_crispy_field }}
                </div>
                <div>
                    {{ form.parking_required|as_crispy_field }}
                </div>
            </div>

            <!-- Beach Stay -->
            <hr class="my-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6 max-w-sm mx-auto">
                <div>
                    {{ form.num_beach_stay_adults|as_crispy_field }}
                </div>
                <div>
                    {{ form.num_beach_stay_children|as_crispy_field }}
                </div>
            </div>

            <!-- Discount -->
            <div class="mb-6 max-w-sm mx-auto">
                {{ form.apply_discount|as_crispy_field }}
            </div>
            
           
            <div id="floatingContainer">
                <!-- Total Price -->
                <div id="totalPriceBox" class="floating-box">
                    <h5>Cena ko≈Ñcowa: <span id="totalPrice">0</span> PLN</h5>
                </div>
            
                <!-- Reservation Button -->
                <button id="reservationButton" type="submit">
                    Zarezerwuj
                </button>
            </div>
            <!-- Submit Button -->
         
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {

            // Get the actual rendered input IDs for start_date and end_date
            const startDateInput = document.getElementById('{{ form.start_date.auto_id }}');
            const endDateInput = document.getElementById('{{ form.end_date.auto_id }}');
            
            // Initialize Flatpickr on the start_date field
            flatpickr(startDateInput, {
                dateFormat: "Y-m-d",
                minDate: "today",
                onChange: function(selectedDates, dateStr, instance) {
                    // Set the minimum date of the end date based on the start date
                    flatpickr(endDateInput, {
                        dateFormat: "Y-m-d",
                        minDate: dateStr
                    });
                }
            });

            // Initialize Flatpickr on the end_date field with today's date as the minimum
            flatpickr(endDateInput, {
                dateFormat: "Y-m-d",
                minDate: "today"
            });


            const totalPriceEl = document.getElementById('totalPrice');

            const numAdults = document.getElementById('{{ form.num_adults.id_for_label }}');
            const numChildren0_3 = document.getElementById('{{ form.num_children_0_3.id_for_label }}');
            const numChildren4_13 = document.getElementById('{{ form.num_children_4_13.id_for_label }}');
            const caravanRequired = document.getElementById('{{ form.caravan_required.id_for_label }}');
            const electricityForTent = document.getElementById('{{ form.electricity_for_tent.id_for_label }}');
            const electricityForCaravan = document.getElementById('{{ form.electricity_for_caravan.id_for_label }}');
            const extraPersonCount = document.getElementById('{{ form.extra_person_count.id_for_label }}');

            function calculateTotalPrice() {
                let totalPrice = 0;

                const pricePerAdult = parseInt(document.getElementById('price_per_adult').value);
                const pricePerChild0_3 = parseInt(document.getElementById('price_per_child_0_3').value);
                const pricePerChild4_13 = parseInt(document.getElementById('price_per_child_4_13').value);
                const priceForCaravan = parseInt(document.getElementById('price_for_caravan').value);
                const priceForElectricityTent = parseInt(document.getElementById('price_for_electricity_tent').value);
                const priceForElectricityCaravan = parseInt(document.getElementById('price_for_electricity_caravan').value);
                const pricePerExtraPerson = parseInt(document.getElementById('price_per_extra_person').value);

                // Adults
                totalPrice += (numAdults.value ? parseInt(numAdults.value) * pricePerAdult : 0);

                // Children 0-3
                totalPrice += (numChildren0_3.value ? parseInt(numChildren0_3.value) * pricePerChild0_3 : 0);

                // Children 4-13
                totalPrice += (numChildren4_13.value ? parseInt(numChildren4_13.value) * pricePerChild4_13 : 0);

                // Extra person
                totalPrice += (extraPersonCount.value ? parseInt(extraPersonCount.value) * pricePerExtraPerson : 0);

                // Caravan
                if (caravanRequired.checked) {
                    totalPrice += priceForCaravan;
                }

                // Electricity for tent
                if (electricityForTent.checked) {
                    totalPrice += priceForElectricityTent;
                }

                // Electricity for caravan
                if (electricityForCaravan.checked) {
                    totalPrice += priceForElectricityCaravan;
                }

                totalPriceEl.textContent = totalPrice;
            }

            // Add event listeners to form inputs
            [numAdults, numChildren0_3, numChildren4_13, extraPersonCount, caravanRequired, electricityForTent, electricityForCaravan].forEach(input => {
                input.addEventListener('change', calculateTotalPrice);
            });

            // Initial calculation on page load
            calculateTotalPrice();
        });
    </script>
{% endblock %}
